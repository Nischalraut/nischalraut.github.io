<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>NISCHAL RAUT | AEROSPACE ENGINEER</title>
    
    <link rel="icon" type="image/svg+xml" href="data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 100 100'%3E%3Cpolygon points='50,10 90,90 50,75 10,90' fill='%23FC3D21'/%3E%3C/svg%3E">

    <!-- LIBRARIES -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/three.js/r128/three.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/gsap/3.12.2/gsap.min.js"></script>
    
    <!-- FONTS -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link href="https://fonts.googleapis.com/css2?family=JetBrains+Mono:wght@100;400;800&family=Rajdhani:wght@300;500;600;700&family=Syncopate:wght@400;700&display=swap" rel="stylesheet">

    <style>
        /* VARIABLES */
        :root {
            --c-void: #030405;
            --c-panel: rgba(8, 12, 16, 0.85);
            --c-border: rgba(255, 255, 255, 0.1);
            --c-prim: #FC3D21; 
            --c-prim-dim: rgba(252, 61, 33, 0.15);
            --c-cyan: #00F3FF;
            --c-text: #E0E6ED;
            --c-muted: #64748B;
            --nav-w: 80px;
            --head-h: 80px;
            --f-head: 'Syncopate', sans-serif;
            --f-body: 'Rajdhani', sans-serif;
            --f-code: 'JetBrains Mono', monospace;
        }

        * { margin: 0; padding: 0; box-sizing: border-box; cursor: none; user-select: none; }
        
        body {
            background-color: var(--c-void); color: var(--c-text);
            font-family: var(--f-body); overflow: hidden;
            width: 100vw; height: 100vh;
        }

        /* LAYERS */
        #gl-canvas { position: fixed; inset: 0; z-index: 0; }
        
        .scanlines {
            position: fixed; inset: 0; z-index: 10; pointer-events: none;
            background: linear-gradient(to bottom, rgba(255,255,255,0), rgba(255,255,255,0) 50%, rgba(0,0,0,0.3) 50%, rgba(0,0,0,0.3));
            background-size: 100% 4px; opacity: 0.4;
        }
        
        .vignette {
            position: fixed; inset: 0; z-index: 9; pointer-events: none;
            background: radial-gradient(circle, transparent 40%, #000 130%);
        }

        /* CURSOR */
        #cursor {
            position: fixed; top: 0; left: 0; width: 20px; height: 20px;
            border: 1px solid var(--c-prim); transform: translate(-50%, -50%) rotate(45deg);
            pointer-events: none; z-index: 10000; mix-blend-mode: exclusion;
            transition: width 0.2s, height 0.2s;
        }
        #cursor-follower {
            position: fixed; top: 0; left: 0; width: 40px; height: 40px;
            border: 1px dashed var(--c-prim); border-radius: 50%;
            transform: translate(-50%, -50%); pointer-events: none; z-index: 9999;
            opacity: 0.5; transition: 0.1s ease-out;
        }
        body.hovering #cursor { width: 50px; height: 50px; background: rgba(255,255,255,0.1); }

        /* HUD */
        header {
            position: fixed; top: 0; left: 0; width: 100%; height: var(--head-h);
            display: flex; justify-content: space-between; align-items: center;
            padding: 0 3rem; background: rgba(3, 4, 5, 0.9); border-bottom: 1px solid var(--c-border);
            z-index: 100; backdrop-filter: blur(10px);
        }
        .brand { font-family: var(--f-head); font-size: 1.5rem; letter-spacing: 2px; }
        .brand span { color: var(--c-prim); }
        .hud-stats { display: flex; gap: 20px; font-family: var(--f-code); font-size: 10px; color: var(--c-cyan); }

        aside {
            position: fixed; top: var(--head-h); left: 0; bottom: 0; width: var(--nav-w);
            border-right: 1px solid var(--c-border); background: rgba(3, 4, 5, 0.6);
            display: flex; flex-direction: column; justify-content: center; align-items: center; gap: 3rem;
            z-index: 90;
        }
        .nav-icon {
            font-family: var(--f-code); font-size: 10px; color: var(--c-muted);
            writing-mode: vertical-rl; transform: rotate(180deg); letter-spacing: 2px;
            cursor: pointer; transition: 0.3s; padding: 10px 0;
        }
        .nav-icon:hover, .nav-icon.active { color: var(--c-prim); border-left: 2px solid var(--c-prim); }

        footer {
            position: fixed; bottom: 0; left: var(--nav-w); right: 0; height: 30px;
            background: rgba(0,0,0,0.9); border-top: 1px solid var(--c-border);
            display: flex; align-items: center; padding: 0 20px; z-index: 100;
            font-family: var(--f-code); font-size: 10px; color: var(--c-prim);
        }

        /* SECTORS */
        .sector-wrapper {
            position: absolute; top: var(--head-h); left: var(--nav-w); right: 0; bottom: 30px;
            display: flex; flex-direction: column; justify-content: center; align-items: center;
            opacity: 0; pointer-events: none; transform: scale(1.2); transition: 0.1s;
            padding: 2rem; overflow: hidden;
        }
        .sector-wrapper.active { opacity: 1; pointer-events: auto; transform: scale(1); }

        .content-box {
            width: 100%; max-width: 1200px; padding: 2rem;
            display: grid; grid-template-columns: 1.2fr 0.8fr; gap: 4rem; align-items: center;
        }
        .full-box { grid-template-columns: 1fr; max-width: 1000px; }

        h1 { font-family: var(--f-head); font-size: 4rem; line-height: 0.9; margin-bottom: 1rem; color: #fff; }
        h2 { font-family: var(--f-head); font-size: 2.5rem; margin-bottom: 2rem; color: var(--c-prim); }
        p { font-size: 1.1rem; line-height: 1.7; color: var(--c-text); margin-bottom: 1.5rem; }
        .intro-border { border-left: 3px solid var(--c-prim); padding-left: 2rem; background: linear-gradient(90deg, var(--c-prim-dim), transparent); }

        /* Profile */
        .profile-container { position: relative; width: 350px; height: 350px; margin: auto; }
        .p-img { width: 100%; height: 100%; object-fit: cover; clip-path: polygon(20% 0%, 80% 0%, 100% 20%, 100% 80%, 80% 100%, 20% 100%, 0% 80%, 0% 20%); filter: grayscale(0.5); }
        .hud-ring {
            position: absolute; border: 1px dashed var(--c-cyan); border-radius: 50%;
            animation: rotate 20s linear infinite; pointer-events: none; opacity: 0.5;
        }
        .r1 { top: -10%; left: -10%; width: 120%; height: 120%; border-color: var(--c-prim); }
        .r2 { top: -20%; left: -20%; width: 140%; height: 140%; animation-direction: reverse; }
        @keyframes rotate { to { transform: rotate(360deg); } }

        /* Panels */
        .glass-panel {
            background: var(--c-panel); border: 1px solid var(--c-border); padding: 3rem;
            backdrop-filter: blur(10px); position: relative;
        }
        .glass-panel::before {
            content: ''; position: absolute; top:0; left:0; width:4px; height:100%; background: var(--c-prim);
        }

        /* Skills */
        .skill-item { margin-bottom: 1.5rem; }
        .skill-head { display: flex; justify-content: space-between; font-family: var(--f-code); font-size: 12px; margin-bottom: 5px; }
        .skill-track { width: 100%; height: 4px; background: rgba(255,255,255,0.1); }
        .skill-fill { height: 100%; background: var(--c-prim); box-shadow: 0 0 10px var(--c-prim); }

        /* Cards */
        .grid-cards { display: grid; grid-template-columns: repeat(2, 1fr); gap: 2rem; }
        .card {
            background: rgba(255,255,255,0.03); border: 1px solid var(--c-border); padding: 2rem;
            transition: 0.3s; cursor: pointer;
        }
        .card:hover { transform: translateY(-5px); border-color: var(--c-prim); background: var(--c-prim-dim); }
        .tag { font-family: var(--f-code); font-size: 10px; color: var(--c-cyan); border: 1px solid var(--c-cyan); padding: 2px 6px; display: inline-block; margin-bottom: 10px; }

        /* BOTTOM NAV BUTTON */
        .warp-trigger {
            position: fixed; bottom: 50px; left: 50%; transform: translateX(-50%);
            display: flex; flex-direction: column; align-items: center; z-index: 500;
            transition: opacity 0.5s; cursor: pointer;
        }
        .warp-btn {
            background: rgba(0,0,0,0.8); border: 1px solid var(--c-prim);
            color: var(--c-prim); font-family: var(--f-head); font-size: 1rem;
            padding: 15px 40px; clip-path: polygon(10px 0, 100% 0, 100% calc(100% - 10px), calc(100% - 10px) 100%, 0 100%, 0 10px);
            transition: 0.3s; text-transform: uppercase; letter-spacing: 2px;
            pointer-events: auto; width: 300px;
        }
        .warp-btn:hover { background: var(--c-prim); color: #000; box-shadow: 0 0 30px var(--c-prim-glow); }

        /* BOOT SCREEN */
        #boot-layer {
            position: fixed; inset: 0; background: #000; z-index: 9999;
            display: flex; flex-direction: column; justify-content: center; align-items: center;
        }
        .init-btn {
            padding: 20px 50px; background: transparent; border: 1px solid #fff; color: #fff;
            font-family: var(--f-head); cursor: pointer; transition: 0.3s;
        }
        .init-btn:hover { background: #fff; color: #000; }

        /* MODAL */
        #modal {
            position: fixed; inset: 0; background: rgba(0,0,0,0.95); z-index: 1500;
            display: flex; align-items: center; justify-content: center; opacity: 0; pointer-events: none; transition: 0.3s;
        }
        #modal.open { opacity: 1; pointer-events: auto; }
        .modal-box { width: 800px; background: #050505; border: 1px solid var(--c-prim); padding: 3rem; }

        .btn-link {
            display: inline-block; padding: 10px 20px; border: 1px solid var(--c-prim);
            color: var(--c-prim); text-decoration: none; font-family: var(--f-head);
            margin-right: 10px; transition: 0.3s; font-size: 0.8rem;
        }
        .btn-link:hover { background: var(--c-prim); color: #000; }

    </style>
</head>
<body>

    <!-- 3D LAYERS -->
    <canvas id="gl-canvas"></canvas>
    <div class="scanlines"></div>
    <div class="vignette"></div>
    
    <!-- CURSORS -->
    <div id="cursor"></div>
    <div id="cursor-follower"></div>

    <!-- BOOT -->
    <div id="boot-layer">
        <div style="font-family:var(--f-head); font-size:2rem; color:white; margin-bottom:1rem;">PORTFOLIO <span style="color:var(--c-prim)">v11.3</span></div>
        <div style="font-family:var(--f-code); color:var(--c-muted); margin-bottom:2rem;">WARP DRIVE INTEGRATED // AUDIO ENABLED</div>
        <button class="init-btn" onclick="bootUp()">INITIALIZE SYSTEM</button>
    </div>

    <!-- HUD -->
    <header>
        <div class="brand">NISCHAL <span>RAUT</span></div>
        <div class="hud-stats">
            <div>STATUS: ONLINE</div>
            <div>MODE: PROFESSIONAL</div>
            <div id="time">00:00:00</div>
        </div>
    </header>

    <aside>
        <div class="nav-icon active" onclick="warpTo(0)">HOME</div>
        <div class="nav-icon" onclick="warpTo(1)">SKILLS</div>
        <div class="nav-icon" onclick="warpTo(2)">PROJECTS</div>
        <div class="nav-icon" onclick="warpTo(3)">EXP</div>
        <div class="nav-icon" onclick="warpTo(4)">CONTACT</div>
    </aside>

    <footer>
        > SYSTEM READY. WAITING FOR INPUT..._
    </footer>

    <!-- CONTENT SECTORS -->
    
    <!-- 0. HOME -->
    <div id="sec-0" class="sector-wrapper active">
        <div class="content-box">
            <div>
                <div style="font-family:var(--f-code); color:var(--c-prim); margin-bottom:10px;">AEROSPACE ENGINEER</div>
                <h1>NISCHAL<br>RAUT</h1>
                <div class="intro-border">
                    <p>I am an Aerospace Engineering graduate with a strong focus on experimental aerodynamics, wind tunnel design, and unsteady flow analysis. My work centers on translating theoretical models into physical systems, with hands-on experience in gust generation, flow visualization, and aerodynamic testing.</p>
                    <p>I have worked extensively with tools such as ANSYS, MATLAB, SolidWorks, and LaTeX to support both experimental and analytical investigations. Through academic projects and industry exposure, I have developed a methodical approach to problem-solving.</p>
                </div>
            </div>
            <div class="profile-container">
                <div class="hud-ring r1"></div>
                <div class="hud-ring r2"></div>
                <img src="nischal.png" alt="Profile" class="p-img">
            </div>
        </div>
    </div>

    <!-- 1. SKILLS -->
    <div id="sec-1" class="sector-wrapper">
        <div class="content-box full-box">
            <h2>TECHNICAL SKILLS</h2>
            <div style="display:grid; grid-template-columns:1fr 1fr; gap:4rem;">
                <div class="glass-panel">
                    <h3 style="font-family:var(--f-code); color:var(--c-cyan); margin-bottom:1rem;">// COMPETENCIES</h3>
                    
                    <div class="skill-item">
                        <div class="skill-head"><span>CFD (ANSYS)</span><span>70%</span></div>
                        <div class="skill-track"><div class="skill-fill" style="width:70%"></div></div>
                    </div>
                    <div class="skill-item">
                        <div class="skill-head"><span>CAD (CATIA)</span><span>80%</span></div>
                        <div class="skill-track"><div class="skill-fill" style="width:80%"></div></div>
                    </div>
                    <div class="skill-item">
                        <div class="skill-head"><span>PROGRAMMING (PYTHON/C)</span><span>60%</span></div>
                        <div class="skill-track"><div class="skill-fill" style="width:60%"></div></div>
                    </div>
                    <div class="skill-item">
                        <div class="skill-head"><span>EXPERIMENTAL (WIND TUNNEL)</span><span>80%</span></div>
                        <div class="skill-track"><div class="skill-fill" style="width:80%"></div></div>
                    </div>
                </div>

                <div class="glass-panel" style="text-align:center; border-style:dashed; cursor:pointer;" onclick="unlockVault()">
                    <div style="font-size:3rem; margin-bottom:1rem;">ðŸ”’</div>
                    <h3 style="margin-bottom:1rem;">ACADEMIC PERFORMANCE</h3>
                    <div style="font-family:var(--f-code); color:var(--c-muted);">IOE PULCHOWK RECORDS</div>
                    <div id="vault-viz" style="display:none; height:150px; align-items:flex-end; gap:5px; margin-top:20px;"></div>
                    <div id="vault-res" style="display:none; margin-top:10px; font-weight:bold; color:var(--c-prim);">AGGREGATE: 76.71%</div>
                </div>
            </div>
        </div>
    </div>

    <!-- 2. PROJECTS -->
    <div id="sec-2" class="sector-wrapper">
        <div class="content-box full-box">
            <h2>SELECTED PROJECTS</h2>
            <div class="grid-cards">
                <div class="card" onclick="openModal('tunnel')">
                    <span class="tag">RESEARCH</span>
                    <h3>SUBSONIC WIND TUNNEL</h3>
                    <p style="font-size:0.9rem; color:#ccc;">Design and dev of open-jet tunnel with gust generator.</p>
                </div>
                <div class="card" onclick="openModal('b52')">
                    <span class="tag">DESIGN</span>
                    <h3>B-52 AIR LAUNCH</h3>
                    <p style="font-size:0.9rem; color:#ccc;">Retrofitting B-52 for smallsat launch feasibility.</p>
                </div>
                <div class="card" onclick="openModal('glider')">
                    <span class="tag">FABRICATION</span>
                    <h3>STYROFOAM GLIDER</h3>
                    <p style="font-size:0.9rem; color:#ccc;">Scratch-built RC aircraft with XFLR5 Analysis.</p>
                </div>
                <div class="card" onclick="openModal('f15')">
                    <span class="tag">CFD</span>
                    <h3>F-15 FLOW ANALYSIS</h3>
                    <p style="font-size:0.9rem; color:#ccc;">Supersonic flow simulation (Mach 2.5) in ANSYS.</p>
                </div>
            </div>
        </div>
    </div>

    <!-- 3. EXPERIENCE -->
    <div id="sec-3" class="sector-wrapper">
        <div class="content-box full-box">
            <h2>PROFESSIONAL EXPERIENCE</h2>
            <div class="glass-panel">
                <div style="margin-bottom:3rem; border-left:1px solid var(--c-cyan); padding-left:2rem;">
                    <div style="font-family:var(--f-code); font-size:12px; color:var(--c-prim);">DEC 2024 - PRESENT</div>
                    <h3>ASSOCIATE ENGINEER</h3>
                    <div style="font-size:0.9rem; color:var(--c-muted); margin-top:5px;">AIRBUS INDIA - INTEGRATION TEST & ANALYTICS</div>
                    <p style="font-size:0.9rem; margin-top:10px;">Responsible for integration testing of avionics subsystems. Leveraging data analytics to optimize flight test campaigns.</p>
                </div>
                <div style="margin-bottom:3rem; border-left:1px solid var(--c-cyan); padding-left:2rem;">
                    <div style="font-family:var(--f-code); font-size:12px; color:var(--c-prim);">JULY 2024 - NOV 2024</div>
                    <h3>SYSTEM TESTING INTERN</h3>
                    <div style="font-size:0.9rem; color:var(--c-muted); margin-top:5px;">AIRBUS INDIA</div>
                    <p style="font-size:0.9rem; margin-top:10px;">Supported system Verification & Validation (V&V). Performed functional testing on simulation benches.</p>
                </div>
                <div style="border-left:1px solid var(--c-cyan); padding-left:2rem;">
                    <div style="font-family:var(--f-code); font-size:12px; color:var(--c-prim);">2024</div>
                    <h3>ENGINEERING INTERN</h3>
                    <div style="font-size:0.9rem; color:var(--c-muted); margin-top:5px;">AIRLIFT TECHNOLOGY</div>
                    <p style="font-size:0.9rem; margin-top:10px;">Led drone mapping initiatives for Kathmandu Metropolitan City. Processed photogrammetry data.</p>
                </div>
            </div>
        </div>
    </div>

    <!-- 4. CONTACT -->
    <div id="sec-4" class="sector-wrapper">
        <div class="content-box full-box">
            <div class="glass-panel" style="text-align:center; max-width:600px; margin:auto;">
                <h2>GET IN TOUCH</h2>
                <p>nischalraut6@gmail.com</p>
                <div style="margin-bottom:2rem;">
                    <a href="https://linkedin.com" target="_blank" class="btn-link">LINKEDIN</a>
                    <a href="https://github.com" target="_blank" class="btn-link">GITHUB</a>
                </div>
                <button class="warp-btn" onclick="warpTo(0)">RETURN TO HOME</button>
            </div>
        </div>
    </div>

    <!-- WARP TRIGGER BUTTON (Dynamic Label) -->
    <div class="warp-trigger" onclick="nextSector()">
        <div style="font-family:var(--f-code); font-size:10px; margin-bottom:5px; color:var(--c-muted);">NAVIGATION</div>
        <button class="warp-btn" id="warp-label">GO TO SKILLS</button>
    </div>

    <!-- MODAL -->
    <div id="modal">
        <div class="modal-box">
            <div style="text-align:right; cursor:pointer;" onclick="closeModal()">[ CLOSE ]</div>
            <h2 id="m-title" style="margin-top:0;">TITLE</h2>
            <p id="m-desc" style="color:#ccc;">...</p>
        </div>
    </div>

    <script>
        /* 
        ========================================================================
        1. FLIGHT STATE & AUDIO
        ========================================================================
        */
        const flightState = { speed: 0 };
        let audioCtx;
        const sectionNames = ["HOME", "SKILLS", "PROJECTS", "EXPERIENCE", "CONTACT"];

        function initAudio() {
            audioCtx = new (window.AudioContext || window.webkitAudioContext)();
        }

        function playWarpSound(duration) {
            if(!audioCtx) return;
            const osc = audioCtx.createOscillator();
            const gain = audioCtx.createGain();
            osc.frequency.setValueAtTime(100, audioCtx.currentTime);
            osc.frequency.exponentialRampToValueAtTime(12000, audioCtx.currentTime + duration);
            gain.gain.setValueAtTime(0.2, audioCtx.currentTime);
            gain.gain.exponentialRampToValueAtTime(0.001, audioCtx.currentTime + duration);
            osc.connect(gain);
            gain.connect(audioCtx.destination);
            osc.start();
            osc.stop(audioCtx.currentTime + duration);
        }

        function playClick() {
            if(!audioCtx) return;
            const osc = audioCtx.createOscillator();
            const gain = audioCtx.createGain();
            osc.type = 'square';
            osc.frequency.value = 800;
            gain.gain.value = 0.05;
            osc.connect(gain);
            gain.connect(audioCtx.destination);
            osc.start();
            osc.stop(audioCtx.currentTime + 0.05);
        }

        /* 
        ========================================================================
        2. THREE.JS ENGINE
        ========================================================================
        */
        let scene, camera, renderer, globe, flowField, starField;

        function init3D() {
            const canvas = document.getElementById('gl-canvas');
            scene = new THREE.Scene();
            camera = new THREE.PerspectiveCamera(75, window.innerWidth/window.innerHeight, 0.1, 2000);
            camera.position.z = 20;

            renderer = new THREE.WebGLRenderer({ canvas, alpha: true, antialias: true });
            renderer.setSize(window.innerWidth, window.innerHeight);

            // 1. Globe
            const gGeo = new THREE.IcosahedronGeometry(8, 2);
            const gMat = new THREE.MeshBasicMaterial({ color: 0x112233, wireframe: true, transparent: true, opacity: 0.2 });
            globe = new THREE.Mesh(gGeo, gMat);
            scene.add(globe);

            // 2. Flow Particles
            const pGeo = new THREE.BufferGeometry();
            const pCount = 2000;
            const pPos = new Float32Array(pCount * 3);
            for(let i=0; i<pCount*3; i++) pPos[i] = (Math.random()-0.5) * 60;
            pGeo.setAttribute('position', new THREE.BufferAttribute(pPos, 3));
            const pMat = new THREE.PointsMaterial({ size: 0.1, color: 0xFC3D21, transparent: true, opacity: 0.6 });
            flowField = new THREE.Points(pGeo, pMat);
            scene.add(flowField);

            // 3. Starfield (Hidden normally)
            const sGeo = new THREE.BufferGeometry();
            const sCount = 5000;
            const sPos = new Float32Array(sCount * 3);
            for(let i=0; i<sCount*3; i++) sPos[i] = (Math.random()-0.5) * 800;
            sGeo.setAttribute('position', new THREE.BufferAttribute(sPos, 3));
            const sMat = new THREE.PointsMaterial({ size: 0.5, color: 0xFFFFFF });
            starField = new THREE.Points(sGeo, sMat);
            starField.visible = false;
            scene.add(starField);

            animate();
        }

        function animate() {
            globe.rotation.y += 0.002;
            flowField.rotation.y -= 0.001;
            globe.rotation.x += (window.mouseY * 0.0001 - globe.rotation.x) * 0.05;
            globe.rotation.y += (window.mouseX * 0.0001 - globe.rotation.y) * 0.05;

            // WARP EFFECT
            if(flightState.speed > 0.5) {
                starField.visible = true;
                globe.visible = false;
                flowField.visible = false;
                
                const pos = starField.geometry.attributes.position.array;
                for(let i=2; i<pos.length; i+=3) {
                    pos[i] += flightState.speed * 5;
                    if(pos[i] > 200) pos[i] = -600;
                }
                starField.geometry.attributes.position.needsUpdate = true;
                starField.scale.z = 1 + flightState.speed;
            } else {
                starField.visible = false;
                globe.visible = true;
                flowField.visible = true;
            }

            renderer.render(scene, camera);
            requestAnimationFrame(animate);
        }

        /* 
        ========================================================================
        3. NAVIGATION LOGIC
        ========================================================================
        */
        let currentIdx = 0;
        const totalSec = 5;
        let isWarping = false;

        function bootUp() {
            initAudio();
            playClick();
            gsap.to('#boot-layer', { yPercent: -100, duration: 1, ease: 'power4.inOut' });
            init3D();
        }

        function nextSector() {
            warpTo((currentIdx + 1) % totalSec);
        }

        function updateButtonLabel(idx) {
            const nextIdx = (idx + 1) % totalSec;
            document.getElementById('warp-label').innerText = `GO TO ${sectionNames[nextIdx]}`;
        }

        function warpTo(idx) {
            if(isWarping || idx === currentIdx) return;
            isWarping = true;
            playClick();

            if(audioCtx && audioCtx.state === 'suspended') audioCtx.resume();

            const dist = Math.abs(idx - currentIdx);
            const duration = 1.0 + (dist * 0.3);
            playWarpSound(duration);

            const oldSec = document.getElementById(`sec-${currentIdx}`);
            const newSec = document.getElementById(`sec-${idx}`);
            const oldDot = document.querySelectorAll('.nav-icon')[currentIdx];
            const newDot = document.querySelectorAll('.nav-icon')[idx];

            oldSec.classList.remove('active');
            if(oldDot) oldDot.classList.remove('active');
            document.querySelector('.warp-trigger').style.opacity = 0;

            // WARP ANIMATION
            gsap.to(flightState, {
                speed: 20, 
                duration: duration * 0.4,
                ease: "power2.in",
                onComplete: () => {
                    gsap.to(flightState, {
                        speed: 0,
                        duration: duration * 0.6,
                        ease: "power2.out",
                        onComplete: () => {
                            isWarping = false;
                            newSec.classList.add('active');
                            if(newDot) newDot.classList.add('active');
                            currentIdx = idx;
                            updateButtonLabel(currentIdx);
                            document.querySelector('.warp-trigger').style.opacity = 1;
                        }
                    });
                }
            });
        }

        /* 
        ========================================================================
        4. INTERACTIONS
        ========================================================================
        */
        window.mouseX = 0; window.mouseY = 0;
        document.addEventListener('mousemove', e => {
            window.mouseX = e.clientX - window.innerWidth/2;
            window.mouseY = e.clientY - window.innerHeight/2;
            
            const cursor = document.getElementById('cursor');
            const follow = document.getElementById('cursor-follower');
            gsap.to(cursor, { x: e.clientX, y: e.clientY, duration: 0 });
            gsap.to(follow, { x: e.clientX, y: e.clientY, duration: 0.15 });
            
            if(e.target.tagName === 'BUTTON' || e.target.classList.contains('card') || e.target.classList.contains('nav-icon')) {
                document.body.classList.add('hovering');
            } else {
                document.body.classList.remove('hovering');
            }
        });

        // Clock
        setInterval(() => {
            const n = new Date();
            document.getElementById('time').innerText = n.toISOString().split('T')[1].split('.')[0];
        }, 1000);

        // Vault
        const marks = [{v:59.68},{v:67.43},{v:65.29},{v:69.14},{v:78.4},{v:83.75},{v:86.15},{v:89.2}];
        function unlockVault() {
            playClick();
            const viz = document.getElementById('vault-viz');
            viz.style.display = 'flex';
            document.getElementById('vault-res').style.display = 'block';
            viz.innerHTML = marks.map(m => `<div style="flex:1; background:var(--c-prim); height:0%; transition:height 1s ease;" data-h="${m.v}%"></div>`).join('');
            setTimeout(() => viz.querySelectorAll('div').forEach(d => d.style.height = d.getAttribute('data-h')), 100);
        }

        // Modals
        const mData = {
            tunnel: { t:"WIND TUNNEL", d:"Design of open-jet tunnel with gust generator. Validated 0.88% TI." },
            b52: { t:"B-52 LAUNCH", d:"Feasibility of B-52 as smallsat carrier. Optimized for LEO." },
            glider: { t:"UAV GLIDER", d:"Scratch-built RC aircraft. Analysis via XFLR5." },
            f15: { t:"CFD ANALYSIS", d:"Mach 2.5 simulation in ANSYS. Shock diamond visualization." }
        };
        function openModal(id) {
            playClick();
            document.getElementById('m-title').innerText = mData[id].t;
            document.getElementById('m-desc').innerText = mData[id].d;
            document.getElementById('modal').classList.add('open');
        }
        function closeModal() {
            playClick();
            document.getElementById('modal').classList.remove('open');
        }

    </script>
</body>
</html>

